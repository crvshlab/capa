#!/usr/bin/env ruby

require_relative '../lib/capa'

abort('Please install gifify: https://github.com/vvo/gifify') unless command?('gifify')

recorder = SimulatorRecorder.new(filename: @video_filename)
generator = GIFGenerator.new(input_video: @video_filename, output_gif: "#{@video_filename}.gif")

begin
  recorder.record
rescue Capa::UserAbort
  puts 'Exiting...'
  if system('pgrep simctl > /dev/null')
    `killall simctl`
  end
  exit
end

generator.generate